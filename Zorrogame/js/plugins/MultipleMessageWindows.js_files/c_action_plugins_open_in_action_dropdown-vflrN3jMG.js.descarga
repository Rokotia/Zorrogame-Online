!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="462fa364-b1aa-3616-80cb-9775f17c7877")}catch(e){}}();
define(["exports","react","./e_file_viewer_static_scl_page_file","./c_cloud_docs_hooks","./c_extensions_open_button_utils","./c_core_i18n","./c_ui_sprite","./c_api_v2_routes_password_confirmation_provider","./c_dig-icons_assets_ui-icon_line_sidebar-show-right","./c_spectrum_svg_icon_bundle","./c_dig-icons_assets_ui-icon_line_admin-console","./c_cloud_docs_open_with_utils","./c_memoize-one","./e_core_exception","./c_lodash-es_lodash","./c_src_sink_index","./c_api_v2_routes_cloud_docs_provider","./e_edison","./c_chat_chat_constants","./c_init_data_edison","./c_init_data_debug_panel","./c_react-use_misc_util","./e_data_modules_stormcrow","./c_watermarking_utils_getImageDefaultSizes","./c_api_v2_client_base","./c_spectrum_util_raf_throttle","./c_core_notify","react-dom","./c_spectrum_util_uuid_generator","./c_security_csrf_hmac","./c_spectrum_modal_utility_modal","./c_spectrum_button","./c_spectrum_tertiary_link","./c_icon_templates_actionable_index","./c_spectrum_icon_form_index","./c_icon_templates_stateless_index","./c_ui_image","./c_dig-icons_assets_ui-icon_line_shuffle","metaserver/static/js/langpack"],(function(e,t,n,o,i,s,r,c,a,l,p,u,d,_,m,A,f,h,I,g,O,y,E,w,x,v,C,S,k,b,U,F,M,D,B,L,T,H,N){"use strict";function W(e){return e&&e.__esModule?e:{default:e}}var V=W(t);class R extends V.default.Component{constructor(e){super(e),this.handleMouseOver=()=>{clearTimeout(this.timer),this.timer=setTimeout((()=>{this.props.bylines&&(this.setState({show:!0}),this.props.onDidShow())}),this.props.delay)},this.handleMouseOut=()=>{this.setState({show:!1}),clearTimeout(this.timer)},this.triggerRef=V.default.createRef(),this.state={show:!1}}componentWillUnmount(){clearTimeout(this.timer)}render(){const{children:e,bylines:t,isInActionBar:o}=this.props,i=V.default.Children.only(e);return t?V.default.createElement(V.default.Fragment,null,V.default.createElement(n.Tooltip.Control,{triggerRef:this.triggerRef,open:this.state.show,placement:o?"right":"left"},(e=>{if(e)return e.length>1?V.default.createElement("ul",{className:"extensions-byline-list"},e.map((e=>V.default.createElement("li",{key:e,className:"extensions-byline-list-item"},e)))):V.default.createElement("div",{className:"extensions-byline"},e[0])})(t)),V.default.cloneElement(i,{onMouseOver:this.handleMouseOver,onMouseOut:this.handleMouseOut,ref:this.triggerRef})):i}}R.defaultProps={delay:500},R.displayName="ExtensionsBylineTooltip";class P extends V.default.Component{render(){const{unityOptions:e,legacyCloudEditorOptions:t,cloudEditorAppActions:o,bylines:s,currentSession:l,previewOption:p,openInReplayOption:u,openInDesktopOption:d,isInActionBar:_,goToFolderOption:m,wrapValuesForActionBar:A,openInNewTabOption:f,openInQuickViewOption:h}=this.props,I=e=>A?i.toActionBarValue(e):e,g=t.map((e=>{const{type:t}=e,o=t===n.OpenButtonAction.OPEN_WITH_CLOUD_DOC?"cloud_doc":"wopi";return V.default.createElement(n.Menu.ActionItem,{key:e.text,value:I(e),withLeftAccessory:e.spriteName?V.default.createElement(r.Sprite,{group:"web",name:e.spriteName,alt:""}):V.default.createElement("img",{alt:"",src:e.iconUrl,width:24,height:24})},V.default.createElement(R,{isInActionBar:_,bylines:s[o],onDidShow:n.handleShowByline(o,l),key:e.text},V.default.createElement("span",null,e.text)))})),O=e.map((e=>V.default.createElement(n.Menu.ActionItem,{key:e.text,value:I(e),withLeftAccessory:function(e){return"ow_desktop"===e.spriteName&&e.type===n.OpenButtonAction.UNITY_FILE?-1!==e.text.indexOf("Dropbox")?V.default.createElement(n.UIIcon,{src:n.DropboxLine}):V.default.createElement(n.UIIcon,{src:n.OpenLine}):V.default.createElement(r.Sprite,{group:"web",name:e.spriteName||"",alt:""})}(e)},e.text)));let y=!1;const E=o.map((e=>{y||(y=i.isWopiAction(e.appAction));const t=e.appAction.handler.editor_name;return V.default.createElement(n.Menu.ActionItem,{key:e.appAction.description,value:I(e),withLeftAccessory:V.default.createElement("img",{alt:"",src:e.appAction.icon.url,width:24,height:24})},V.default.createElement(R,{isInActionBar:_,bylines:s[t],onDidShow:n.handleShowByline(t,l),key:e.appAction.description},V.default.createElement("span",null,e.appAction.description)))})),w=p&&V.default.createElement(n.Menu.ActionItem,{key:p.text,value:I(p),withLeftAccessory:V.default.createElement(n.UIIcon,{src:n.ShowLine})},p.text),x=u&&V.default.createElement(n.Menu.ActionItem,{key:u.text,value:I(u),withLeftAccessory:V.default.createElement(n.UIIcon,{src:n.DropboxReplayLine})},u.text),v=d&&V.default.createElement(n.Menu.ActionItem,{key:d.text,value:I(d),withLeftAccessory:V.default.createElement(n.UIIcon,{src:c.mac?n.FinderLine:n.FileExplorerLine})},d.text),C=f&&V.default.createElement(n.Menu.ActionItem,{key:f.text,value:I(f),withLeftAccessory:V.default.createElement(n.UIIcon,{src:n.GlobeLine})},f.text),S=m&&V.default.createElement(n.Menu.ActionItem,{key:m.text,value:I(m),withLeftAccessory:V.default.createElement(n.UIIcon,{src:a.FolderShowLine})},m.text),k=h&&V.default.createElement(n.Menu.ActionItem,{key:h.text,value:I(h),withLeftAccessory:V.default.createElement(n.UIIcon,{src:a.SidebarShowRightLine})},h.text),b=O.length>0||g.length>0||E.length>0||!!C||!!w||!!x||!!v||!!S||!!k;return y?b&&V.default.createElement(n.Menu.Segment,{key:"open-options"},E,C,S,O,g,w,k,x,v):b&&V.default.createElement(n.Menu.Segment,{key:"open-options"},C,S,O,g,E,w,k,x,v)}}P.displayName="UnityAndCloudEditorsComponent";const K=n.requireCssWithComponent(P,["/static/metaserver/static/css/app_actions/index-vflR8Wunv.css","/static/metaserver/static/css/dig-components/index.web-vflkUceyC.css"]);class q extends V.default.Component{constructor(e){super(e),this.createAppActionClickHandler=e=>()=>{var t,o;const{file:s,user:r,featureFlags:c,telemetryContext:a}=this.props;if(i.redirectToActionOrShowAuth(r,[s],e,c,a),"redirect"===e.handler[".tag"]){const t=n.getAppActionExtras(e);n.logEvent$1(this.props.currentSession,"select_action",{menu_version:2,...t})}else if("cloud_editor"===e.handler[".tag"]){const t={};i.isWopiAction(e)?(t.type=n.OpenButtonAction.OPEN_WITH,t.userAction=n.OpenInUserAction.OpenInOfficeOnline):t.type=n.OpenButtonAction.OPEN_WITH_CLOUD_DOC,n.logEvent$1(this.props.currentSession,"select_legacy_action",t)}null===(o=(t=this.props).onExtensionClick)||void 0===o||o.call(t,e)},this.wrapperForAction=e=>({appAction:e,handler:this.createAppActionClickHandler(e),userAction:n.OpenInUserAction.OpenWithAppAction,actionName:e.description}),this.renderActionRow=e=>{const t=e.icon;let o;o=t.is_static?i.genericAppIcon:t.url;const s=e.description,r=this.props.isInActionBar?i.toActionBarValue(this.wrapperForAction(e)):this.wrapperForAction(e);return V.default.createElement(n.Menu.ActionItem,{key:e.id,value:r,withLeftAccessory:V.default.createElement("img",{alt:"",src:o,width:24,height:24})},s)},this.renderUnpromotedActions=(e,t)=>{const{user:o,file:r,categoryIdToInfos:c,featureFlags:a,currentSession:p,telemetryContext:u,isInActionBar:d}=this.props,_=e.length>0,m={handler:()=>{const l=[...e,...t];i.showExtensionsMiniDirectoryModal(s.intl.formatMessage({id:"KVD2SP",defaultMessage:"Open or edit with these apps"}),o,r,l,c,a,u,p),n.logEvent$1(p,_?"select_show_more":"select_add_app",{surface:u&&u.surface,userAction:_?n.OpenInUserAction.OpenMoreApps:n.OpenInUserAction.OpenAddApps})}},A=d?i.toActionBarValue(m):m;return V.default.createElement(n.Menu.ActionItem,{key:s.intl.formatMessage({id:"R/67N/",defaultMessage:"Show more"}),value:A,withLeftAccessory:_&&!d?null:V.default.createElement(n.UIIcon,{src:l.AddCircleLine})},_?s.intl.formatMessage({id:"Gevpqz",defaultMessage:"Connect more apps"}):s.intl.formatMessage({id:"XFA09U",defaultMessage:"Connect apps"}))}}render(){const{appActions:e,openOptions:t,bylines:o,currentSession:s,isInActionBar:r}=this.props,c=n.getOpenOptionsWithLogging(t,s),{unityOptions:a,cloudEditorOptions:l,previewOption:u,openInReplayOption:d,openInDesktopOption:_,goToFolderOption:m,openInNewTabOption:A,openInQuickViewOption:f,installDropboxAppOption:h,manageAsAdminOption:I}=n.partitionOptions(c),{cloudEditors:g,installedActions:O,unpromotedActions:y}=n.partitionActions(e),E=O.length>0,w=y.length>0,x=e=>r?i.toActionBarValue(e):e;return V.default.createElement(V.default.Fragment,null,h&&V.default.createElement(n.Menu.Segment,{withLabel:h.withLabel},V.default.createElement(n.Menu.ActionItem,{key:h.text,value:x(h),withLeftAccessory:V.default.createElement(n.UIIcon,{src:n.DownloadLine})},h.text)),V.default.createElement(K,{isInActionBar:r,unityOptions:a,legacyCloudEditorOptions:l,cloudEditorAppActions:g.map((e=>this.wrapperForAction(e))),bylines:o,currentSession:s,previewOption:u,openInReplayOption:d,openInNewTabOption:A,openInDesktopOption:_,goToFolderOption:m,openInQuickViewOption:f,wrapValuesForActionBar:!!r}),I&&V.default.createElement(n.Menu.Segment,null,V.default.createElement(n.Menu.ActionItem,{key:I.text,value:x(I),withLeftAccessory:V.default.createElement(n.UIIcon,{src:p.AdminConsoleLine})},I.text)),r&&(E||w)&&V.default.createElement(n.Menu.Segment,null,O.map((e=>this.renderActionRow(e))),this.renderUnpromotedActions(O,y)),!r&&E&&V.default.createElement(n.Menu.Segment,{key:"installed-actions"},O.map((e=>this.renderActionRow(e)))),!r&&w&&V.default.createElement(n.Menu.Segment,null,this.renderUnpromotedActions(O,y)))}}q.displayName="BrowseFilePopoverContentComponent";const Q=n.requireCssWithComponent(q,["/static/metaserver/static/css/app_actions/index-vflR8Wunv.css"]);class $ extends V.default.Component{constructor(e){super(e),this.createActionClickHandler=e=>()=>{if("cloud_editor"===e.handler[".tag"]){const t=i.isWopiAction(e)?n.OpenButtonAction.OPEN_WITH:n.OpenButtonAction.OPEN_WITH_CLOUD_DOC;n.logEvent$1(this.props.currentSession,"select_legacy_action",{type:t});const o=n.UserActionSourceType.WEB_PREVIEW,s=i.cloudEditorNameToParams(e.handler.editor_name);u.openWithCloudEditor(u.fileToOpenWithParams(this.props.file),this.props.user,s,!1,o)}}}render(){if(0===this.props.openOptions.length&&0===this.props.cloudEditorAppActions.length)return null;const e=this.props.cloudEditorAppActions.map((e=>({appAction:e,handler:this.createActionClickHandler(e),userAction:n.OpenInUserAction.OpenWithAppAction,actionName:e.description})));return V.default.createElement(K,{unityOptions:[],legacyCloudEditorOptions:this.props.openOptions,cloudEditorAppActions:e,bylines:{},wrapValuesForActionBar:!!this.props.isInActionBar})}}$.displayName="SharedFilePopoverContentComponent";const z=n.requireCssWithComponent($,["/static/metaserver/static/css/app_actions/index-vflR8Wunv.css"]),G=e=>{const{file:t,user:s,telemetryContext:r,extraOptions:c,isInActionBar:a,previewActionHandler:l,openDesktopActionHandler:p,goToFolderActionHandler:u,replayActionHandler:d,openInNewTabActionHandler:_,quickViewActionHandler:m,onExtensionClick:A,installDropboxAppActionHandler:f,manageAsAdminActionHandler:h}=e,I=n.useAppActions().data,g=n.getOpenActionsForFile(I.actions,t),O=n.parseActionsForUserResult(I),y=O.bylines,E=I.category_infos,w=O.featureFlags,x=o.useCloudDocsInfo(s),v=n.useUnity(t,s),C=i.getCategoryIdToInfos(E),S=i.getOpenOptionsForFile({file:t,unityInfo:v,extraOptions:c,user:s,isCloudEditorDisabled:!0,cloudDocsInfo:x,surface:null==r?void 0:r.surface,isInActionBar:a,previewActionHandler:l,openDesktopActionHandler:p,goToFolderActionHandler:u,replayActionHandler:d,openInNewTabActionHandler:_,quickViewActionHandler:m,installDropboxAppActionHandler:f,manageAsAdminActionHandler:h}),k=r&&(e.currentSession||n.createTelemetryClient({component:"menu_v2"}).session({surface:r.surface,ext:n.getPiiSafeExtension(n.getFileExt(t)||""),feature_flags:w}));if(n.isBrowseFile(t)&&g&&(g.length>0||S.length>0))return V.default.createElement(Q,{file:t,user:s,openOptions:S,appActions:g,bylines:y,categoryIdToInfos:C,featureFlags:w,telemetryContext:r,currentSession:k,isInActionBar:a,onExtensionClick:A});if(n.isSharedFile(t)){const{cloudEditors:e}=n.partitionActions(g||[]);return V.default.createElement(z,{openOptions:S,cloudEditorAppActions:e,file:t,user:s,currentSession:k,isInActionBar:a})}return null};G.displayName="ExtensionsPopoverContent";const j=new Set([".pptx",".docx",".xlsx",".ppt",".doc",".xls"]),X="open_in_install_desktop_app",Y="previews",J="preview_toolbar",Z=()=>{window.open("https://www.dropbox.com/downloading?_tk=open_in_explorer_install_dc","_blank")},ee={[n.OpenInUserAction.OpenInUnityFolder]:"desktop_folder",[n.OpenInUserAction.OpenInUnity]:"desktop_preview",[n.OpenInUserAction.OpenInReplay]:"replay_preview",[n.OpenInUserAction.PreviewFile]:"web_preview",[n.OpenInUserAction.OpenInDesktop]:"desktop_file",[n.OpenInUserAction.OpenMoreApps]:"connect_more_apps",[n.OpenInUserAction.OpenAddApps]:"connect_apps",[n.OpenInUserAction.OpenInOfficeOnline]:"office_online",[n.OpenInUserAction.InstallDropboxApp]:"downloading_page"},te={surface:"previews"},ne=({actionContext:e,file:t,user:o,surface:i})=>{const{logUserAction:s,loggingSessionId:r}=n.useFileViewerContext(),c=n.useReplayActionHandler(t),{variant:a}=n.useExperimentVariant("open_in_explorer_install_dc"),l=((e,t,o,i)=>{if(!t||t===n.Variant.OFF)return!1;const s=`.${n.getExtension(e)}`,r=j.has(s),c=i!==n.SDKPreviewSurface.QUICK_VIEW_BROWSE&&i!==n.SDKPreviewSurface.QUICK_VIEW_SEARCH;return r&&!(e instanceof n.FileSharedWithMe)&&n.isLiveFile(e)&&n.isBrowseFile(e)&&!n.isEncryptedFile(e)&&!n.isInsideVaultFolder(e)&&c})(t,a,0,i);n.useLogExposureOnce("open_in_explorer_install_dc",!l);const p=((e,t)=>{if(t===n.Variant.V1&&e)return Z})(l,a);V.default.useEffect((()=>{p&&(e=>{const t=n.getExtension(e),o=t.startsWith(".")?t.slice(1):t,i=n.getFileTypeFromString(o);n.UDCL.logEvent({class:"navigation",action:"shown",object:"content_action_upsell",properties:{contentAction:X,actionSurface:Y,actionElement:J,fileType:i,upsellVariant:"v1"}},{tags:{content_action:X,action_surface:Y,action_element:J,...i&&{file_type:i},upsell_variant:"v1"}})})(t)}),[p,t]);const u=V.default.useMemo((()=>({sessionId:r,event:(t,o)=>{var r;if("show_byline"===t)return;const c="string"==typeof(null==o?void 0:o.userAction)?o.userAction:"",a=null!==(r=ee[c])&&void 0!==r?r:"third_party_app";let l="previews";i===n.SDKPreviewSurface.QUICK_VIEW_BROWSE?l="browse_quick_view":i===n.SDKPreviewSurface.QUICK_VIEW_SEARCH&&(l="search_quick_view"),s(n.UserAction.OpenIn,e,{...o,destination_surface:a,actionSurface:l})}})),[e,s,r,i]);return V.default.createElement(G,{key:"open-in-action-btn",file:t,user:o,isInActionBar:!0,openDesktopActionHandler:n.makeOpenInDesktopHandler(t,o),replayActionHandler:c,installDropboxAppActionHandler:p,currentSession:u,telemetryContext:te})};ne.displayName="OpenInMenuContent";const oe=n.withActionCondition(n.openInActionConditions,((e,t)=>t?{icon:n.OpenLine,label:n.OPEN_IN_ACTION_STRING,disabled:{disabled:!1},userAction:n.UserAction.OpenIn,action:{type:"menu",menu:V.default.createElement(ne,{user:e.user,file:e.file,actionContext:n.UserActionContext.FileMenu})}}:void 0),void 0);e.OpenInMenuContent=ne,e.makeOpenInAction=oe}));
//# sourceMappingURL=c_action_plugins_open_in_action_dropdown.js-vflnp84xR.map

//# debugId=462fa364-b1aa-3616-80cb-9775f17c7877