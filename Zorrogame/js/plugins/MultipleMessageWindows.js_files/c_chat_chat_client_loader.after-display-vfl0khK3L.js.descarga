!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="c2029d30-14d1-3764-bdaa-701b39ab1d42")}catch(e){}}();
define(["require","exports","./c_memoize-one","./e_file_viewer_static_scl_page_file","./e_core_exception","./c_lodash-es_lodash","react","./c_src_sink_index","./c_api_v2_routes_password_confirmation_provider","./c_api_v2_routes_cloud_docs_provider","./e_edison","./c_chat_chat_constants","./c_init_data_edison","./c_init_data_debug_panel","./c_react-use_misc_util","./e_data_modules_stormcrow","./c_watermarking_utils_getImageDefaultSizes","./c_api_v2_client_base","./c_spectrum_util_raf_throttle","./c_core_i18n","metaserver/static/js/langpack","./c_core_notify","react-dom","./c_spectrum_util_uuid_generator","./c_security_csrf_hmac"],(function(e,t,i,n,o,a,s,c,r,_,l,h,d,u,p,C,g,m,f,A,w,k,M,P,v){"use strict";function D(e){return e.ns("megaphone_chat")}const I=new class{constructor(){this.loadClient=(e,t)=>{if(e){const i=t.chatStoneToProtoModule.chatStoneToProto(e);t.chatClientModule.ChatClientSingleton.setupChatEnvironment(i)}},this.getBestChatCampaignAndLoadChatClient=(e,t,i)=>{const n={url:e};if(i){return D(new t.defaultUserClientModule.DefaultUserApiV2Client(i)).rpc("get_best_chat_campaigns",n,{}).then((e=>this.loadClient(e.props,t)))}return D(new t.noAuthClientModule.NoAuthApiV2Client).rpc("get_best_chat_campaigns",n,{}).then((e=>this.loadClient(e.props,t)))},this.getChatCampaignByIdAndLoadClient=(e,t,i,n)=>{const o={url:e,campaign_id:t,locale:window.navigator.language?window.navigator.language:window.navigator.browserLanguage};if(n){return D(new i.defaultUserClientModule.DefaultUserApiV2Client(n)).rpc("get_chat_campaign_by_id",o,{}).then((e=>this.loadClient(e.props,i)))}return D(new i.noAuthClientModule.NoAuthApiV2Client).rpc("get_chat_campaign_by_id",o,{}).then((e=>this.loadClient(e.props,i)))},this.resumeOrGetBestChatCampaignAndLoadClient=(e,t,i,n)=>e?Promise.resolve(this.loadClient(e,t)):this.getBestChatCampaignAndLoadChatClient(i,t,n),this.getResumedChatCampaignAndLoadClient=(e,t,i,n,o)=>{const a={url:e,legacy_persistence_cookie:t||"",chat_persistence_cookie:i||""};if(o){return D(new n.defaultUserClientModule.DefaultUserApiV2Client(o)).rpc("get_resumed_chat_campaign",a,{}).then((t=>this.resumeOrGetBestChatCampaignAndLoadClient(t.props,n,e,o)))}return D(new n.noAuthClientModule.NoAuthApiV2Client).rpc("get_resumed_chat_campaign",a,{}).then((t=>this.resumeOrGetBestChatCampaignAndLoadClient(t.props,n,e,o)))},this.importDependencies=()=>Promise.all([new Promise((function(t,i){e(["./e_file_viewer_static_scl_page_file"],t,i)})).then((function(e){return e.default_user_client_esnext})),new Promise((function(t,i){e(["./e_file_viewer_static_scl_page_file"],t,i)})).then((function(e){return e.noauth_client_esnext})),new Promise((function(t,i){e(["./c_chat_chat_stone_to_proto"],t,i)})),new Promise((function(t,i){e(["./c_chat_chat_client"],t,i)})).then((function(e){return e.chat_client_esnext})),new Promise((function(t,i){e(["./c_init_data_debug_panel"],t,i)})).then((function(e){return e.cookies_esnext})),new Promise((function(t,i){e(["./c_chat_chat_constants"],t,i)})).then((function(e){return e.chat_constants_esnext}))]),this.getCookies=(e,t)=>{const{Cookies:i}=e,{SNAPENGAGE_CHAT_VISIBLE_COOKIE:n,CHAT_CAMPAIGN_VISIBLE_COOKIE:o}=t;return{legacy_persistence_cookie:i.read(n),chat_persistence_cookie:i.read(o)}},this.getCampaignFromChatServiceWithDependencies=([e,t,i,n,o,a],s,c)=>{const r={defaultUserClientModule:e,noAuthClientModule:t,chatStoneToProtoModule:i,chatClientModule:n,cookiesModule:o,chatConstantsModule:a},_=this.getCookies(o,a);return _.legacy_persistence_cookie||_.chat_persistence_cookie?this.getResumedChatCampaignAndLoadClient(s,_.legacy_persistence_cookie,_.chat_persistence_cookie,r,c):this.getBestChatCampaignAndLoadChatClient(s,r,c)},this.getChatCampaignIDFromChatServiceWithDependencies=([e,t,i,n,o,a],s,c,r)=>{const _={defaultUserClientModule:e,noAuthClientModule:t,chatStoneToProtoModule:i,chatClientModule:n,cookiesModule:o,chatConstantsModule:a},l=this.getCookies(o,a);return l.legacy_persistence_cookie||l.chat_persistence_cookie?this.getResumedChatCampaignAndLoadClient(s,l.legacy_persistence_cookie,l.chat_persistence_cookie,_,r):this.getChatCampaignByIdAndLoadClient(s,c,_,r)},this.loadChatClientWithBestCampaign=(e,t,i)=>{if(this.loadPromise)return this.loadPromise;const o=i?Promise.resolve():n.waitForTTI({timeoutMS:5e3});return this.loadPromise=o.then((()=>this.importDependencies())).then((i=>this.getCampaignFromChatServiceWithDependencies(i,e,t))),this.loadPromise},this.loadCampaignByID=(e,t,i)=>(this.loadPromise||(this.loadPromise=this.importDependencies().then((n=>this.getChatCampaignIDFromChatServiceWithDependencies(n,e,t,i)))),this.loadPromise)}};t.default=I}));
//# sourceMappingURL=c_chat_chat_client_loader.after-display.js-vfl9het_t.map

//# debugId=c2029d30-14d1-3764-bdaa-701b39ab1d42