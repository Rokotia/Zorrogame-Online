!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="ac884a0a-06ea-3c55-96ff-c80a871188c9")}catch(e){}}();
define(["exports","./c_spectrum_util_raf_throttle","./e_core_exception","./e_file_viewer_static_scl_page_file","react","./c_core_i18n"],(function(e,r,t,o,i,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}var l=n(i);const s={GDrive:{displayName:"Google Drive",importType:{".tag":"gdrive"},signinServiceDisplayName:"Google",profileServicesConstant:o.ProfileServicesConstants.GOOGLE,profileServicesApiServiceType:{".tag":"google"},defaultDestPath:"Google Drive",profileServicesAction:"link_read_files"},OneDrive:{displayName:"Microsoft OneDrive",importType:{".tag":"onedrive"},signinServiceDisplayName:"Microsoft",profileServicesConstant:o.ProfileServicesConstants.OUTLOOK,profileServicesApiServiceType:{".tag":"outlook"},defaultDestPath:"Microsoft OneDrive",profileServicesAction:"access_files_and_wiki"}},c={GotIt:()=>a.intl.formatMessage({id:"j8BdSl",defaultMessage:"Got it"}),TryAgain:()=>a.intl.formatMessage({id:"HImQBL",defaultMessage:"Try again"}),Cancel:()=>a.intl.formatMessage({id:"cp7jer",defaultMessage:"Cancel"}),CloseAriaLabel:()=>a.intl.formatMessage({id:"F4pNeQ",defaultMessage:"Close"}),ViewDetails:()=>a.intl.formatMessage({id:"YPmkDk",defaultMessage:"View details"}),HideDetails:()=>a.intl.formatMessage({id:"p8xGcP",defaultMessage:"Hide details"})};const d="browse",p=e=>{switch(e[".tag"]){case"gdrive":return"google_drive";case"onedrive":return"one_drive"}},u=e=>{switch(e[".tag"]){case"gdrive":return"google_drive";case"onedrive":return"one_drive"}},f=e=>{o.UDCL.logEvent({class:"file_imports",action:"select",object:"try_again",properties:{actionSurface:d,externalProvider:u(e)}})},v=()=>a.intl.formatMessage({id:"h2PZeS",defaultMessage:"Google"}),g=()=>a.intl.formatMessage({id:"MDiUcD",defaultMessage:"Google Drive"}),m=()=>a.intl.formatMessage({id:"Ur1/IM",defaultMessage:"Microsoft"}),_=()=>a.intl.formatMessage({id:"rfdy2l",defaultMessage:"OneDrive"}),S=()=>a.intl.formatMessage({id:"dObY3n",defaultMessage:"Unknown"}),E=e=>{switch(e[".tag"]){case"gdrive":return g();case"onedrive":return _()}return S()},w=e=>{switch(e[".tag"]){case"gdrive":return v();case"onedrive":return m()}return S()},C=(e,r,o)=>t.reportStack(r,{severity:e,tags:["FileImports"],exc_extra:o,silent:!1}),h={info:(e,r)=>C(t.SEVERITY.OPERATIONAL,e,r),warn:(e,r)=>C(t.SEVERITY.NONCRITICAL,e,r),error:(e,r)=>C(t.SEVERITY.CRITICAL,e,r),uncaught:(e,r)=>C(t.SEVERITY.UNCAUGHT,e,r)};var D,P,y,x;!function(e){e.OpenGdriveFilePicker="OpenGdriveFilePicker"}(D||(D={})),e.FilePickerAction=void 0,(P=e.FilePickerAction||(e.FilePickerAction={})).PICKED="PICKED",P.CANCELED="CANCELED",e.FilePickerViewId=void 0,(y=e.FilePickerViewId||(e.FilePickerViewId={})).DOCS="all",y.FOLDERS="folders",function(e){e.IframeLoaded="IframeLoaded",e.FilePickerResult="FilePickerResult",e.SignInWithDifferentAccount="SignInWithDifferentAccount",e.UnhandledError="UnhandledError",e.UnhandledRejection="UnhandledRejection"}(x||(x={}));o.injectInternalStyle("/static/metaserver/static/js/file_imports/gdrive/file_picker.module.out-vflUvIQdI.css",(e=>"._overlay_g01kv_1{background-color:var(--color__utility__overlay);height:100%;left:0;position:fixed;top:0;transition-delay:0;transition-duration:.333;transition-property:opacity;transition-timing-function:cubic-bezier(.66,0,0,1);width:100%;z-index:10001}"));const b="_overlay_g01kv_1",F=e=>a.intl.formatMessage({id:"ibOvmo",defaultMessage:"Couldnâ€™t get a response from {serviceProvider} servers"},{serviceProvider:w(e)}),L=e=>a.intl.formatMessage({id:"kL19SV",defaultMessage:"You can try again, or download your files and folders from {service} and drag them into Dropbox."},{service:E(e)}),M=({open:e,onRequestClose:r,supportedService:t,tryAgain:a})=>(i.useEffect((()=>{var e;e=t.importType,o.UDCL.logEvent({class:"file_imports",action:"shown",object:"external_api_error",properties:{actionSurface:d,externalProvider:u(e)}})}),[t.importType]),l.default.createElement(o.Modal$1,{onRequestClose:r,open:e,isCentered:!0,withCloseButton:c.CloseAriaLabel()},l.default.createElement(o.Modal$1.Header,{hasBottomSpacing:"title-standard"},l.default.createElement(o.Modal$1.Title,null,F(t.importType))),l.default.createElement(o.Modal$1.Body,{hasVerticalSpacing:!1},l.default.createElement(o.Text,{tagName:"p"},L(t.importType))),l.default.createElement(o.Modal$1.Footer,null,l.default.createElement(o.Button,{variant:"opacity",onClick:r,autoFocus:!0},c.GotIt()),l.default.createElement(o.Button,{variant:"primary",autoFocus:!0,onClick:()=>{r(),a(),f(t.importType)}},c.TryAgain())))),k=(e,r)=>{o.Modal.showInstance(l.default.createElement(M,{supportedService:e,open:!0,onRequestClose:()=>o.Modal.close(),tryAgain:r}))},I=async e=>new Promise((r=>setTimeout(r,e)));let U,A,T,j,O=null,N=()=>{},G="",R=()=>{};const B=`https://${r.getDomains().FILE_IMPORTS_SUBDOMAIN}`,V=e=>{var r;O&&(N(e),null===(r=O.parentNode)||void 0===r||r.removeChild(O),window.removeEventListener("message",j),O=null,N=()=>{})},$=r=>(j=async t=>{var o;if(!O||t.origin!==B||t.source!==O.contentWindow||!(null===(o=t.data)||void 0===o?void 0:o.hasOwnProperty("eventType")))return;const i=t.data;switch(i.eventType){case x.IframeLoaded:(null==O?void 0:O.contentWindow)&&O.contentWindow.postMessage({eventType:D.OpenGdriveFilePicker,accessToken:G,views:U,rootId:A,title:T,hideSwitchAccountButton:!R,multiFileImportEnabled:r},B);break;case x.FilePickerResult:V(i.result);break;case x.SignInWithDifferentAccount:V({action:e.FilePickerAction.CANCELED}),null==R||R();break;case x.UnhandledError:h.warn(`Unhandled error in file picker iframe: ${i.error}`),await(async()=>{await I(500),V({action:e.FilePickerAction.CANCELED}),await I(50)})();k(s.GDrive,(()=>{q(G,R,U,A,T,r)}));break;case x.UnhandledRejection:h.warn(`Unhandled rejection in file picker iframe: ${i.error}`)}},j),q=(e,r,t,o,i,a)=>new Promise((n=>{if(O)throw new Error("File picker already open");G=e,R=r,N=n,U=t,A=o,T=i,O=document.createElement("iframe"),O.setAttribute("allowTransparency","true"),O.setAttribute("sandbox","allow-scripts allow-same-origin allow-modals"),O.setAttribute("src",B),O.setAttribute("frameBorder","0"),O.classList.add(b),document.body.appendChild(O),window.addEventListener("message",$(a))}));e.Buttons=c,e.FileImportsExclog=h,e.SupportedServices=s,e.getLocalizedLoginServiceName=w,e.getLocalizedServiceName=E,e.getSupportedService=e=>{switch(e[".tag"]){case"gdrive":return s.GDrive;case"onedrive":return s.OneDrive}throw new Error(`Bad import type: ${JSON.stringify(e)}`)},e.logCancelImportJob=e=>{o.UDCL.logEvent({class:"file_imports",action:"cancel",object:"import_job",properties:{actionSurface:d,externalProvider:u(e)}})},e.logFailConnectExternalAccount=e=>{o.UDCL.logEvent({class:"file_imports",action:"fail",object:"connect_external_account",properties:{actionSurface:d,externalProvider:p(e)}})},e.logPartialSucceedImportJob=({importType:e,srcFilesTotal:r,srcFilesSucceeded:t,srcFilesFailed:i,num4xxErrors:a,num5xxErrors:n,numOtherErrors:l,allErrorCounts:s})=>{o.UDCL.logEvent({class:"file_imports",action:"partial_succeed",object:"import_job",properties:{actionSurface:d,externalProvider:u(e),srcFilesTotal:r,srcFilesSucceeded:t,srcFilesFailed:i,num_4xxErrors:a,num_5xxErrors:n,numOtherErrors:l,allErrorCounts:s}})},e.logSelectDeleteSource=e=>{o.UDCL.logEvent({class:"file_imports",action:"select",object:"delete_source",properties:{actionSurface:d,externalProvider:u(e)}})},e.logSelectFolderStructure=e=>{o.UDCL.logEvent({class:"file_imports",action:"select",object:"folder_structure",properties:{actionSurface:d,externalProvider:u(e)}})},e.logSelectOverquotaUpgrade=e=>{o.UDCL.logEvent({class:"file_imports",action:"select",object:"overquota_upgrade",properties:{actionSurface:d,externalProvider:u(e)}})},e.logSelectOverwriteFiles=e=>{o.UDCL.logEvent({class:"file_imports",action:"select",object:"overwrite_files",properties:{actionSurface:d,externalProvider:u(e)}})},e.logSelectTryAgain=f,e.logSelectViewDetails=e=>{o.UDCL.logEvent({class:"file_imports",action:"select",object:"view_details",properties:{actionSurface:d,externalProvider:u(e)}})},e.logShownFailedCancel=e=>{o.UDCL.logEvent({class:"file_imports",action:"shown",object:"failed_cancel",properties:{actionSurface:d,externalProvider:u(e)}})},e.logShownImportAlreadyRunning=e=>{o.UDCL.logEvent({class:"file_imports",action:"shown",object:"import_already_running",properties:{actionSurface:d,externalProvider:u(e)}})},e.logShownImportOptions=e=>{o.UDCL.logEvent({class:"file_imports",action:"shown",object:"import_options",properties:{actionSurface:d,externalProvider:u(e)}})},e.logShownNetworkError=e=>{o.UDCL.logEvent({class:"file_imports",action:"shown",object:"network_error",properties:{actionSurface:d,externalProvider:u(e)}})},e.logShownNoFiles=e=>{o.UDCL.logEvent({class:"file_imports",action:"shown",object:"no_files",properties:{actionSurface:d,externalProvider:u(e)}})},e.logShownOverquotaPrompt=e=>{o.UDCL.logEvent({class:"file_imports",action:"shown",object:"overquota_prompt",properties:{actionSurface:d,externalProvider:u(e)}})},e.logShownPartialUpload=e=>{o.UDCL.logEvent({class:"file_imports",action:"shown",object:"partial_upload",properties:{actionSurface:d,externalProvider:u(e)}})},e.logShownUnknownError=e=>{o.UDCL.logEvent({class:"file_imports",action:"shown",object:"unknown_error",properties:{actionSurface:d,externalProvider:u(e)}})},e.logStartImportJob=e=>{o.UDCL.logEvent({class:"file_imports",action:"start",object:"import_job",properties:{actionSurface:d,externalProvider:u(e)}})},e.logSucceedConnectExternalAccount=e=>{o.UDCL.logEvent({class:"file_imports",action:"succeed",object:"connect_external_account",properties:{actionSurface:d,externalProvider:p(e)}})},e.logSucceedImportJob=({importType:e,srcFilesTotal:r,srcFilesSucceeded:t,srcFilesFailed:i,num4xxErrors:a})=>{o.UDCL.logEvent({class:"file_imports",action:"succeed",object:"import_job",properties:{actionSurface:d,externalProvider:u(e),srcFilesTotal:r,srcFilesSucceeded:t,srcFilesFailed:i,num_4xxErrors:a}})},e.openGdriveFilePicker=q,e.showExternalProviderApiErrorModal=k,e.sleep=I}));
//# sourceMappingURL=c_file_imports_gdrive_file_picker.js-vflKZ614-.map

//# debugId=ac884a0a-06ea-3c55-96ff-c80a871188c9