!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="c8f3d2bf-0f1d-3f5a-80c2-62930ece7ad7")}catch(e){}}();
define(["exports","./e_file_viewer_static_scl_page_file","./c_browse_shared_with_api","./c_sharing_avatar_info","./e_data_modules_stormcrow"],(function(e,a,t,r,s){"use strict";const i={sharedFolderDataByTargetNamespaceId:{},hasSharedDataLoadedByParentPath:{},sharedLinkExistsByFileIdOrPath:{},sharedFileDataByFileId:{},integrationData:void 0},n=e=>a.getStateAtNamespace(e,a.BROWSE_SHARED_WITH_NAMESPACE_KEY)||i;function d(e,a){return["share_ajax:shared_with",e,a.toString()]}const o=e=>a.user(e);let l=null;const h=({parentPath:e,abortCurrentRequest:t=!1})=>(r,s)=>{const i=s();t&&l&&l.abort(),a.isInsideBackupFolder(i)?r(_({parentPath:e})):r(u({parentPath:e}))},_=({parentPath:e})=>(t,r)=>{const s=r(),i=o(s),n=a.mountPoints(s),d={};n&&n.forEach(((e,t)=>d[t]={memberCount:1,joinedMembers:[{...i,access_type:"owner",user_id:i.id,photo_url:i.photo_url,initials:a.getInitials(i.display_name)}]})),t(y.setNamespaceSharedWithData({parentPath:e,sharedFolderData:d}))},u=a.createAsyncThunk(`${a.BROWSE_SHARED_WITH_NAMESPACE_KEY}/fetchSharedWithData`,(async({parentPath:e},{getState:a})=>{const r=a(),i=o(r);return await s.queryClient.fetchQuery(d(e,5),(async()=>await t.getSharedWithFolderData(i,e,5).then((a=>{const t=(e=>{const a={};for(const t of e)a[t.ns_id]={numUndisplayableUsersAndInvites:t.num_avatars_not_shown,groups:t.groups,invitations:t.invitations,joinedMembers:t.joined_members,audienceDescription:t.audience_description,memberCount:t.num_users_and_invites,accessTextData:{total_groups_and_users:t.total_groups_and_users,total_unique_inherited_members:t.total_unique_inherited_members,total_unique_users:t.total_unique_users,users_outside_team:t.users_outside_team,is_confidential:t.is_confidential,isParentTmr:t.is_parent_tmr,is_parent_tsd:t.is_parent_tsd,is_parent_namespace:t.is_parent_namespace,has_team_group:t.has_team_group,has_group:t.has_group}};return a})(a);return{sharedFolderData:t,parentPath:e}})).finally((()=>l=null))))})),c=a.createAsyncThunk(`${a.BROWSE_SHARED_WITH_NAMESPACE_KEY}/fetchSharedFileDataForFiles`,(async(e,{getState:a,dispatch:s,rejectWithValue:i})=>{const n=a(),d=o(n);if(!d.is_email_verified)return i("User's email is not verified.");const l=e.slice(0,100),h=e.slice(100);return await t.listMembersBatch(l,5,d).then((e=>{const a={};return e.forEach(((e,t)=>{a[t]={numUndisplayableUsersAndInvites:0,groups:e.groups.valueSeq().map(r.apiGroupMemberToAvatarInfo).toArray(),invitations:e.invitees.valueSeq().map(r.apiInviteeMemberToAvatarInfo).toArray(),joinedMembers:e.users.valueSeq().map(r.apiUserMemberToAvatarInfo).toArray()}})),(null==h?void 0:h.length)&&s(c(h)),{sharedFileData:a}}))})),p=a.createAsyncThunk(`${a.BROWSE_SHARED_WITH_NAMESPACE_KEY}/fetchSharedLinkExists`,(async(e,{getState:r})=>{const s=r(),i=a.getBrowseState(s).user;if(i)return await t.getSharedLinkExistsForFileIdOrPath(e,i).then((a=>({fileIdOrPath:e,sharedLinkExists:(null==a?void 0:a.length)>0})))})),S=a.createSlice({name:a.BROWSE_SHARED_WITH_NAMESPACE_KEY,initialState:i,reducers:{clear:(e,a)=>i,clearSharedFileDataByFileId:(e,a)=>{e.sharedFileDataByFileId={}},clearSharedLinkExistsCache:(e,a)=>{e.sharedLinkExistsByFileIdOrPath={}},setHasSharedDataLoaded:(e,a)=>{const{payload:t}=a;e.hasSharedDataLoadedByParentPath[t.parentPath]=t.isLoaded},setNamespaceSharedWithData:(e,a)=>{const{payload:t}=a;e.hasSharedDataLoadedByParentPath[t.parentPath]=!0,e.sharedFolderDataByTargetNamespaceId=t.sharedFolderData}},extraReducers:e=>{e.addCase(u.fulfilled,((e,{payload:a})=>{const t={...e.hasSharedDataLoadedByParentPath};return(null==a?void 0:a.parentPath)?(t[a.parentPath]=!0,{...e,hasSharedDataLoadedByParentPath:t,sharedFolderDataByTargetNamespaceId:a.sharedFolderData}):e})).addCase(c.fulfilled,((e,{payload:a})=>({...e,sharedFileDataByFileId:{...e.sharedFileDataByFileId,...a.sharedFileData}}))).addCase(p.fulfilled,((e,a)=>{a.payload&&(e.sharedLinkExistsByFileIdOrPath[a.payload.fileIdOrPath]=a.payload.sharedLinkExists)}))}}),{reducer:m}=S,y=S.actions;let D;e.filesChanged=e=>(t,r)=>{const i=r();e===a.path(i)&&(t(y.clearSharedLinkExistsCache(null)),t(p(e)),s.queryClient.invalidateQueries(d(e,5)),t(h({parentPath:e})),t(y.clearSharedFileDataByFileId(null)),t(((e,t)=>{const r=t(),s=n(r),i=a.sortedFiles(r).reduce(((e,a)=>((e=>!(e.is_dir||e.isDeleted))(a)&&!(a.file_id in s.sharedFileDataByFileId)&&e.push(a.file_id),e)),[]);e(c(i))})))},e.getSharedWithState=n,e.getStoreForSharedWith=()=>(D||(D=a.getStoreAndRegisterReducers({[a.BROWSE_SHARED_WITH_NAMESPACE_KEY]:m})),a.getStoreForBrowse(),D),e.sharedFileDataOutOfDate=e=>a=>{a(c(e))},e.sharedFolderDataOutOfDate=e=>(t,r)=>{if(!e){const t=r();e=a.path(t)}s.queryClient.invalidateQueries(d(e,5)),t(h({parentPath:e}))},e.sharedLinkDataOutOfDate=e=>a=>{e&&a(p(e))}}));
//# sourceMappingURL=c_shared_with_redux_store.js-vflfRSkNQ.map

//# debugId=c8f3d2bf-0f1d-3f5a-80c2-62930ece7ad7