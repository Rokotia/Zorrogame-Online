!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="da9a408e-d65d-3c9e-8599-6b5d335e6a27")}catch(e){}}();
define(["require","exports","react","./e_file_viewer_static_scl_page_file","./c_hooks_use_query_overquota_data","./c_data_store","./e_core_exception","./c_core_i18n","./c_dig-content-icons_icons_file-excel-large","./c_dig-content-icons_icons_file-generic-large","./e_data_modules_stormcrow"],(function(e,t,o,i,a,r,n,l,_,s,d){"use strict";function u(e){return e&&e.__esModule?e:{default:e}}var c=u(o);i.injectInternalStyle("/static/metaserver/static/js/growth/ui/over-quota-sweep-blocking-modal/use_over_quota_sweep_blocking_modal.module.out-vfl2k9bns.css",(e=>"._previewPlaceholder_lc219_1{background:var(--dig-color__background__base);border-radius:8px;height:212px;object-fit:contain;padding-left:40px;width:140px}"));const v="_previewPlaceholder_lc219_1";var p;!function(e){e.LOADING="loading",e.OPEN="open",e.FAILURE="failure",e.USER_NOT_ELIGIBLE_FOR_OVER_QUOTA_SWEEP_MODAL="user_not_eligible_for_over_quota_sweep_modal",e.USER_CONTINUED_ACTION="user_continued_action",e.USER_ABORTED_ACTION="user_aborted_action"}(p||(p={}));const E=(e,t,o,a,r)=>{if(("file_viewer"===e||"quick_view"===e)&&o)return"full_preview"===a?c.default.createElement(i.FileViewer,{...t},c.default.createElement(i.Preview,{...r})):"excel"===a?c.default.createElement(_.FileExcelLarge,{hasWhitespace:!1,className:v,over:"base"}):c.default.createElement(s.FileGenericLarge,{hasWhitespace:!1,className:v,over:"base"})},f=e=>{var t,o,a,r,n,l,_,s,d,u;return!e||!i.isBrowseFile(e)||(null===(t=e.browse_preview)||void 0===t?void 0:t.content)&&(null===(a=null===(o=e.browse_preview)||void 0===o?void 0:o.content)||void 0===a?void 0:a[".tag"])&&!["other","restricted","archive"].includes(null===(n=null===(r=e.browse_preview)||void 0===r?void 0:r.content)||void 0===n?void 0:n[".tag"])?!e||!i.isBrowseFile(e)||(null===(l=e.browse_preview)||void 0===l?void 0:l.content)&&(null===(s=null===(_=e.browse_preview)||void 0===_?void 0:_.content)||void 0===s?void 0:s[".tag"])&&!["excel"].includes(null===(u=null===(d=e.browse_preview)||void 0===d?void 0:d.content)||void 0===u?void 0:u[".tag"])?"full_preview":"excel":"generic"},g=({children:t,action:_,onStatusChange:s,fileToPreview:d})=>{const u=((t,_)=>{const[s,d]=c.default.useState(p.LOADING),{viewer:u,isLoading:v}=i.useViewer(),g=i.useExperimentVariant("sweep_m1_oq_painted_door");(g.error||!g.variant||g.isLoading)&&(g.variant=i.Variant.OFF);const w=(null==g?void 0:g.variant)?g.variant:i.Variant.OFF,O=a.useQueryOverQuota(u),[m,S]=o.useState(void 0),A=c.default.useMemo((()=>new i.ActiveUserApiV2Client),[]),L=c.default.useMemo((()=>({...i.DEFAULT_CONFIG,previewContentOnly:!0,preview_types:{[i.PreviewType.SsrDoc]:{scaleToFit:"width_and_height"},[i.PreviewType.Video]:{no_controls:!0},[i.PreviewType.Audio]:{no_controls:!0}}})),[]),C=c.default.useMemo((()=>({intl:l.intl,apiV2ClientShim:i.makeApiV2ClientShim(A),optionalIOClients:{},isLoggedIn:!!(null==u?void 0:u.active_user),sourceSession:{source_context:i.SourceContext.OverQuotaBlockingModal},featureConfig:L})),[A,L,null==u?void 0:u.active_user]),I=c.default.useMemo((()=>{if(_)return{fileMetadata:{file_id:_.file_id,file_name:i.getFilename(_),size:_.bytes,readOnly:!i.isBrowseFile(_)||!!_.read_only},fileInfo:{file_id:_.file_id,ns_id:_.ns_id,sj_id:_.sjid},fileConfig:{enable_print:!1,enable_view_on_dropbox_button:!0,canEdit:!1}}}),[_]);return c.default.useEffect((()=>{if(v||g.isLoading)return;if([i.Variant.OFF].includes(w)||i.logExposure({feature:"sweep_m1_oq_painted_door",variant:w}),![i.Variant.V1].includes(w))return void d(p.USER_NOT_ELIGIBLE_FOR_OVER_QUOTA_SWEEP_MODAL);if(O&&O.then((e=>{e&&S(e.overQuotaStatus)})),s!==p.LOADING||!m)return;if(void 0===u.active_user||u.active_user.is_team||u.is_paired||m!==r.OverQuotaStatusType.BASIC_OVER_QUOTA)return void d(p.USER_NOT_ELIGIBLE_FOR_OVER_QUOTA_SWEEP_MODAL);const o={action:t,continueCallback:()=>{d(p.USER_CONTINUED_ACTION)},abortCallback:()=>{d(p.USER_ABORTED_ACTION)},filePreview:E(t,C,_,f(_),I)};new Promise((function(t,o){e(["./c_ui_over-quota-sweep-blocking-modal_open_over_quota_sweep_blocking_modal"],t,o)})).then((e=>{e.openOverQuotaSweepBlockingModal(o)})).catch((e=>{d(p.FAILURE),n.reportException({err:e,tags:["discovery","over_quota_sweep_blocking_modal"]})})),d(p.OPEN)}),[t,s,u,v,w,m,O,g.isLoading,C,I,_]),s})(_,d),v=c.default.useRef(null);return c.default.useEffect((()=>{u!==v.current&&(s(u),v.current=u,u===p.LOADING?i.UDCL.logStart("ops.discovery.over_quota_sweep_m1_modal_loading",{tags:{action:_}}):u===p.OPEN?i.UDCL.logEnd("ops.discovery.over_quota_sweep_m1_modal_loading",{eventState:"success",tags:{action:_}}):u===p.USER_NOT_ELIGIBLE_FOR_OVER_QUOTA_SWEEP_MODAL?i.UDCL.logEnd("ops.discovery.over_quota_sweep_m1_modal_loading",{eventState:"canceled",tags:{action:_}}):u===p.FAILURE?i.UDCL.logEnd("ops.discovery.over_quota_sweep_m1_modal_loading",{eventState:"failed",tags:{action:_}}):u!==p.USER_CONTINUED_ACTION&&u!==p.USER_ABORTED_ACTION||i.UDCL.logEvent("ops.discovery.over_quota_sweep_m1_modal_end_state",{tags:{status:u,action:_}}))}),[u,s,_]),u===p.LOADING||u===p.OPEN||u===p.USER_ABORTED_ACTION?null:c.default.createElement(c.default.Fragment,null,t)};g.displayName="OverQuotaSweepBlockingModalWrapper";const w=({children:e,action:t,onStatusChange:o,fileToPreview:a})=>{const{user:n,isLoading:l}=i.useActiveUser();return c.default.useMemo((()=>!l&&n?c.default.createElement(i.Provider,{store:r.getStoreForUpload(n)},c.default.createElement(d.QueryClientProvider,{client:d.queryClient},c.default.createElement(g,{action:t,onStatusChange:o,fileToPreview:a},e))):l||n?null:c.default.createElement(c.default.Fragment,null,e)),[n,l,t,o,a,e])};w.displayName="OverQuotaSweepBlockingModalWrapperWithProviders",t.OverQuotaSweepBlockingModalWrapperWithProviders=w}));
//# sourceMappingURL=c_ui_over-quota-sweep-blocking-modal_over_quota_sweep_blocking_modal_wrapper.js-vflFpzLJC.map

//# debugId=da9a408e-d65d-3c9e-8599-6b5d335e6a27