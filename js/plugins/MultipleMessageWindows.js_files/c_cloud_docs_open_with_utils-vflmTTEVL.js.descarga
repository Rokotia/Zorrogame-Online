!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="46d34b46-25a3-38e0-b41c-92fa446c0222")}catch(e){}}();
define(["require","exports","./c_spectrum_util_raf_throttle","./c_api_v2_routes_cloud_docs_provider","./c_api_v2_routes_password_confirmation_provider","./e_file_viewer_static_scl_page_file","./c_api_v2_client_base","./c_memoize-one","./c_chat_chat_constants","./c_init_data_debug_panel","./c_core_i18n","./c_spectrum_util_uuid_generator","./c_src_sink_index"],(function(e,t,o,r,i,n,c,s,a,d,u,l,_){"use strict";function p(e,t){const o=r.GetCloudDocsRoutes(new n.DefaultUserApiV2Client(e));let i;t.hasOwnProperty("docPathOrId")&&t.docPathOrId&&(i={".tag":"path_or_id",path_or_id:t.docPathOrId});const c=t.data&&t.data.webOpenId,s=t.data&&t.data.origDest,a=t.data&&t.data.routingDest;return o.rpc("log_user_action",{action:t.actionEvent,doc_id:i,source:t.actionSource,open_id:c,orig_dest:s,routing_dest:a,extra_info:t.extra},{})}function f(e){let t="";return e.hasOwnProperty("ext")?t=e.ext:e.hasOwnProperty("filename")?(t=n.file_extension(e.filename),t&&(t="."+t)):(t=n.file_extension(e),t&&(t="."+t)),t}let h;const m=[{id:"word",icon:"word",name:u.intl.formatMessage({id:"HAvNZw",defaultMessage:"Word for the web"}),exts:["odt","docm","docx"],sizeLimitBytes:104857600,editor:n.MicrosoftEditors.WORD},{id:"excel",icon:"excel",name:u.intl.formatMessage({id:"zaRK6L",defaultMessage:"Excel for the web"}),exts:["ods","xlsb","xlsm","xlsx"],sizeLimitBytes:104857600,editor:n.MicrosoftEditors.EXCEL},{id:"powerpoint",icon:"powerpoint",name:u.intl.formatMessage({id:"rvFsee",defaultMessage:"PowerPoint for the web"}),exts:["odp","ppsx","pptx"],sizeLimitBytes:536870912,editor:n.MicrosoftEditors.POWERPOINT}];class E{static initClass(){this.PRELOAD_URLS={},h=["com.adobe.Reader","Acrord32.exe","com.adobe.Acrobat","Acrobat.exe"]}static is_adobe_app(e){return Array.from(h).includes(e)}static getWopiOpenWithButtonInfo(e){if(n.isEncryptedFile(e))return null;let t;t=e.fq_path?e.fq_path:e.filename?e.filename:"";const o=n.file_extension(t);for(const e of m)if(-1!==e.exts.indexOf(o))return e;return null}}E.initClass();const O=()=>n.open_tab(n.LOADING_PAGE_URL,!0);const w=async(t,o)=>{const i=await async function(t){const{DefaultUserApiV2Client:o}=await new Promise((function(t,o){e(["./e_file_viewer_static_scl_page_file"],t,o)})).then((function(e){return e.default_user_client_esnext}));return r.GetCloudDocsRoutes(new o(t))}(t);return i.rpc("get_cloud_editor_url",{file_id:o},{})};function g(e){!function(e){if(void 0!==e&&void 0!==e.error&&void 0!==e.error[".tag"])e.error[".tag"]}(e)}function W(e,t,o,r,i,c,s){const a=l.generateUUID("web_open_id"),u=d.URI.parse(e.cloud_editor_url).updateQuery({cloud_editor:i,web_open_id:a});c&&u.updateQuery({ignore_lock:"1"});const _=u.toString();_&&(void 0===s&&(s=n.UserActionSourceType.WEB),p(r,{actionEvent:n.UserActionEventType.PRE_OPEN,docPathOrId:o,actionSource:s,data:{webOpenId:a}}),null!=t?n.redirect(_,t):n.open_tab(_))}const y=e=>({fileId:e.file_id,openToUrl:e.open_to_url}),x=async({fileId:e,openToUrl:t},r,c,s,a)=>{try{const d=performance.now(),u=_.getMetricsReporter(),l={};try{l.editor=c,a&&(l.source=a[".tag"]);const n=(()=>{let e=!1;if(i.edge||i.msie||i.edgeChromium())try{e=window.self!==window.top}catch(t){e=!0}return e})();if(l.isInEdgeIframe=String(n),t&&t.startsWith(`https://${o.getDomains().WEBSERVER}/scl/fi/`)){l.usedOpenToURLFromFile="true";W({cloud_editor_url:t},null,e,r,c,s,a)}else{l.usedOpenToURLFromFile="false";const t=n?null:O();W(await w(r,e),t,e,r,c,s,a)}l.error="false"}catch(e){l.error="true",g(e)}finally{u.createStats({ns:n.CLOUD_DOCS_AMP_NAMESPACE,name:"web/openWithCloudEditor"},l).recordDuration(performance.now()-d,i.TimeUnit.MILLISECONDS)}}catch(e){g(e)}};t.OpenWithCloudDocProvider=void 0,(t.OpenWithCloudDocProvider||(t.OpenWithCloudDocProvider={})).OfficeOnline="OfficeOnline";const A=(e,o,r)=>{const i=E.getWopiOpenWithButtonInfo(e);return i?{text:i.name,spriteName:i.icon,handler:()=>x(y(e),o,i.editor,!1,r),provider:t.OpenWithCloudDocProvider.OfficeOnline}:null};t.OpenWith=E,t.createPlaceholderTabForNewCloudDoc=O,t.fileToOpenWithParams=y,t.getActionSourceFromNewFileMenuType=e=>{switch(e){case n.NewFileMenuFromType.BROWSE:return n.UserActionSourceType.WEB_BROWSE;case n.NewFileMenuFromType.HOME:return n.UserActionSourceType.WEB_HOME;default:return n.UserActionSourceType.WEB}},t.getActionSourceFromSurface=e=>"search"===e?n.UserActionSourceType.WEB_SEARCH:"previews"===e?n.UserActionSourceType.WEB_PREVIEW:"home_recent"===e||"home_starred"===e?n.UserActionSourceType.WEB_HOME:"browse"===e||"sidebar"===e?n.UserActionSourceType.WEB_BROWSE:n.UserActionSourceType.WEB,t.getOpenWithCloudEditorInfo=(e,t,o,r)=>{const i=[],n=A(e,t,r);return n&&o.wopi&&i.push(n),i},t.isCloudBasedDoc=function(e){return!!function(e){return[".gdoc",".gsheet",".gslides"].indexOf(f(e))>=0}(e)||!!function(e){return".web"===f(e)}(e)},t.logUserAction=p,t.openWithCloudEditor=x}));
//# sourceMappingURL=c_cloud_docs_open_with_utils.js-vflFP3kSC.map

//# debugId=46d34b46-25a3-38e0-b41c-92fa446c0222