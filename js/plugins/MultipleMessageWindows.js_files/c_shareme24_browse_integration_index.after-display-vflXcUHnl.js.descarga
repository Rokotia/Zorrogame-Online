!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="bd298cdd-4a66-3be6-b216-4157356d1b25")}catch(e){}}();
define(["exports","react","./e_file_viewer_static_scl_page_file","./c_core_i18n","./c_file_transfers_lib_utils","./e_data_modules_stormcrow","./e_edison","./c_common_components_layout","./c_stacks_lib_api","./c_utils_dsx_dsx-react","./c_memoize-one","./c_api_v2_client_base","./c_chat_chat_constants","./c_init_data_debug_panel","./c_api_v2_routes_password_confirmation_provider","./c_src_sink_index","./c_shareme24_main","./c_account_email","./c_account_email_verify_reasons","./c_browse_welcome_hub_lib_types","./c_init_data_edison","./e_core_exception","./c_lodash-es_lodash","./c_react-use_misc_util","./c_spectrum_util_raf_throttle","./c_core_notify","react-dom","./c_watermarking_utils_getImageDefaultSizes","./c_spectrum_util_uuid_generator","./c_security_csrf_hmac","metaserver/static/js/langpack","./c_upload_kit_lib_types","./c_api-v2-client_src_dropbox","./c_react_query_helpers_queries_login_and_register_constants","./c_abuse_fingerprintjs_abuse_fpjs_provider","./c_fingerprintjs_fpjs-pro-static_fp","./c_fingerprintjs_botd","./c_shared_with_redux_store","./c_browse_shared_with_api","./c_sharing_avatar_info","./c_contacts_contact","./c_validators","./c_dig-components_chip_index","./c_dig-components_typeahead_index","./c_common_components_buttons","./c_dig-icons_assets_ui-icon_line_share","./c_api_v2_routes_cloud_docs_provider","./c_ui_share-blocking-wrapper_share_blocking_wrapper","./c_ui_locked-state-modal_open_locked_state_modal","./c_trial-plan-card_components_header","./c_dig-components_combinations_index","./c_trial-cards_trial-plan-card2","./c_maestro_nav_shared_code_dropbox_logo","./c_growth-components_partial-bold-text_partial_bold_text","./c_dig-icons_assets_ui-icon_line_upsell","./c_ui_over-quota-sweep-blocking-modal_over_quota_sweep_blocking_modal_wrapper","./c_hooks_use_query_overquota_data","./c_data_store","./c_base64","./c_browse_interface","./c_quota_use_query_quota_upsell_info","./c_react_query_api_helpers_utils","./c_core_transport_rpc_exceptions","./c_dig-content-icons_icons_file-excel-large","./c_dig-content-icons_hooks_useContentIconViewbox","./c_dig-content-icons_icons_file-generic-large","./c_dig-icons_assets_ui-icon_line_team","./c_dig-icons_assets_ui-icon_line_settings","./c_dig-icons_assets_ui-icon_line_lock","./c_dig-icons_assets_ui-icon_line_undo","./c_dig-illustrations_spot_bowl-empty","./c_dig-content-icons_icons_folder-shared-default-small","./c_ui_modal_dig","./c_gen_api_auth_WebAuthWeb","./c_form","./c_account_email_verify","./c_gen_identity_Web","./c_gen_identity_WebIsEmailVerified"],(function(e,t,a,r,i,n,o,s,c,l,_,d,u,p,f,g,m,E,h,v,y,S,b,C,M,w,I,x,k,O,A,$,T,L,D,F,P,R,q,N,V,j,H,U,W,B,Q,G,z,Y,K,Z,X,J,ee,te,ae,re,ie,ne,oe,se,ce,le,_e,de,ue,pe,fe,ge,me,Ee,he,ve,ye,Se,be,Ce){"use strict";function Me(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(a){if("default"!==a){var r=Object.getOwnPropertyDescriptor(e,a);Object.defineProperty(t,a,r.get?r:{enumerable:!0,get:function(){return e[a]}})}})),t.default=e,Object.freeze(t)}var we=Me(t);const Ie=a.createApiv2Query({nsClient:a.GetFilesRoutes,rpc:"list_folder"}),xe=(e,t=!0)=>{t?s.fail(e.formatMessage({id:"ObEiUD",defaultMessage:"Couldn’t complete this request. Try again."})):s.fail(e.formatMessage({id:"VAAIgQ",defaultMessage:"Couldn’t complete this request."}))},ke=({children:e,onFallback:t,onRequestClose:i})=>{const n=m.useData(),o=we.useRef(!1),c=(()=>{const e=r.useIntl();return we.useCallback((t=>{switch(t.loadError.type){case"METADATA_ERROR_V2":switch(t.loadError.response.error[".tag"]){case"email_unverified":return s.fail(e.formatMessage({id:"YQ+xBi",defaultMessage:"Verify your email to share this content."})),!0;case"invalid_oid":return s.fail(e.formatMessage({id:"hBQISs",defaultMessage:"This content doesn’t exist."})),!0;case"no_access":return s.fail(e.formatMessage({id:"S0dPqX",defaultMessage:"You don’t have access to this content."})),!0;case"other":return xe(e),!0;default:return a.exhausts(t.loadError.response.error[".tag"],!1)}case"METADATA_FATAL_V2":return xe(e),!0;default:return!1}}),[e])})();return we.useEffect((()=>{if("error"===n.status&&!o.current){o.current=!0;c(n)?i():t()}}),[n,t,i,c]),we.createElement(we.Fragment,null,e)};ke.displayName="DataLoadingErrorWrapper";const Oe=Symbol("ON_SHOW_VERIFY_EMAIL_MODAL"),{useEmitter:Ae,defaultEmitter:$e}=a.defineLogger((async({event:e,getContextValue:t})=>{const r=t(s.Context$2),i=t(s.Context$3),n=t(s.Context),o={...s.getTags(r),...s.getTags$1(i),...s.getTags$2(n),isSm24:"true"},c={...s.getProperties(r),...s.getProperties$1(i),...s.getProperties$2(n)};e.key===Oe&&(a.UDCL.logEnd("ops.sm24.browse_load",{eventState:"canceled",key:e.payload.sessionId,tags:o}),a.UDCL.logEnd(a.PAP_Load_ShareModal({eventState:"canceled",...c}),{eventState:"canceled",key:e.payload.sessionId,tags:o}),a.UDCL.logEvent("ops.sm24.show_verify_email_modal",{tags:o}))})),Te=({children:e,sessionId:t,onRequestClose:r})=>{var i,n;const o=Ae(),{viewer:s,isLoading:c}=a.useViewer(),l=!c&&!1===(null===(i=s.active_user)||void 0===i?void 0:i.is_email_verified);return we.default.useEffect((()=>{l&&o.select(Oe).emit({sessionId:t})}),[l,t,o]),l?we.default.createElement(E.VerifyEmailModal,{viewer:s,user:s.active_user,reason:h.EmailVerificationReasons.SHMODAL,email:null===(n=s.active_user)||void 0===n?void 0:n.email,onShowChange:()=>{s.active_user&&E.ChangeEmail.show(s,s.active_user,h.EmailVerificationReasons.SHMODAL)},onEmailSent:()=>{E.EmailVerification.get_for_user(s,s.active_user).email_sent(void 0,h.EmailVerificationReasons.SHMODAL,!0),r()},onCancel:r}):we.default.createElement(we.default.Fragment,null,e)};Te.displayName="EmailVerificationWrapper";const Le=e=>{const t=(e=>l.useInitStore(e,(e=>{const t=l.proxy((()=>e.get().fileOrFolder)),a=l.proxy((()=>e.get().user)),r=l.proxy((()=>e.get().shareModalExtras)),i=l.proxy((()=>e.get().actionSurface)),n=l.proxy((()=>e.get().actionElement)),o=l.proxy((()=>e.get().progressiveInbandVariant)),s=l.store(Date.now()),c=l.store(void 0),_=l.store(e.get().isOpen),d=l.proxy((()=>e.get().sessionId)),u=l.proxy((()=>e.get().displayType)),p=l.proxy((()=>{const t=e.get();if("anchored"===t.displayType)return t.anchorRef})),f=l.proxy((()=>{const t=e.get();if("anchored"===t.displayType)return t.overlayPlacement}));return{$fileOrFolder:t,$user:a,$shareModalExtras:r,$isOpen:_,$actionSurface:i,$actionElement:n,$progressiveInbandVariant:o,$openFlexibleEntryPointTimestamp:s,$dwellFlexibleEntryPointActionTimestamp:c,$sessionId:d,$displayType:u,$anchorRef:p,$overlayPlacement:f,$props:e}})))(e),r=a.getOrigin(e.actionSurface,e.actionElement);return we.default.createElement(we.default.Fragment,null,we.default.createElement(s.SharingSdkProvider,{userApiProps:e.user,origin:r,actionInfo:{actionSurface:e.actionSurface}},we.default.createElement(De,{store:t})))};Le.displayName="ShareMe24Browse";const De=({store:e})=>{var t,o;const _=l.useStore(e.$fileOrFolder),d=_.is_dir,u=l.useStore(e.$actionElement),p=l.useStore(e.$actionSurface),f=l.useStore(e.$sessionId),g=l.useStore(e.$isOpen),E=l.useStore(e.$anchorRef),h=l.useStore(e.$overlayPlacement),y=l.useStore(e.$displayType),S=n.useQueryClient();d&&((e,t)=>{Ie.prefetchQuery(e,{apiArg:{path:t,limit:c.STACK_SIZE_LIMIT}})})(S,_.file_id);const b=(e=>we.default.useCallback((()=>{e.$props.get().onRequestClose(),e.$dwellFlexibleEntryPointActionTimestamp.set(void 0)}),[e]))(e),C=(e=>we.default.useCallback((()=>{const{actionSurface:t,actionElement:r}=e.$props.get();"browse_screen"===t&&"browse_directory_row"===r&&a.trackUserLeapEvent(a.SharingUserLeapEvent.SM24_IB_SHARE_COMPLETE,a.getOrigin(t,r)),e.$props.get().onInbandShareCompleted(),e.$isOpen.set(!1)}),[e]))(e),M=we.useCallback((async e=>{a.markMilestoneAsCompleted(e,v.ActivationTileMilestoneId.SHARE_CONTENT)}),[]),{onActionClicked:w,user:I}=e.$props.get(),x=we.default.useMemo((()=>a.getObjectIdentifier(_)),[_]),k=we.default.useMemo((()=>_.is_dir?_.target_ns?{type:"shared_folder"}:{type:"file_folder"}:{type:"file",name:a.filename(_.fq_path),size:_.bytes}),[_]),O=we.default.useMemo((()=>({actionSurface:p,actionElement:u,contentAction:"share",tiburonOrigin:a.getOrigin(p,u),screen:"share_screen",shareModalType:"sm24"})),[p,u]),A=l.useStore(e.$progressiveInbandVariant),$=l.useStore(e.$props).onFallback,{data:T,isLoading:L}=a.useSharingPrefs(),D=null!==(t=null==T?void 0:T.apiData.is_file_transfer_enabled)&&void 0!==t&&t,F=_.is_dir?i.folderEligibleForTransfer(_):!_.is_cloud_doc,P=I.is_team_admin,R=L,q=L?null:null!==(o=null==T?void 0:T.apiData.dash_2025_06_24_fss_stacks_enabled)&&void 0!==o&&o;let N=null,V=null;const j=((e,t=!1)=>{const a=Ie.useQuery({apiArg:{path:e,limit:c.STACK_SIZE_LIMIT}},{staleTime:3e5,enabled:t});return we.useMemo((()=>{var e;if(null==a?void 0:a.isLoading)return{isLoading:!0};if(null==a?void 0:a.error)return{isLoading:!1,isError:!0,error:a.error.appError};{const t=a.data.apiData;if(t.has_more)return{isLoading:!1,isError:!0,error:{".tag":"too_many_contents"}};const r=[];for(const a of t.entries)if("id"in a){if("folder"===a[".tag"]&&(null===(e=a.sharing_info)||void 0===e?void 0:e.no_access))continue;r.push({fileId:a.id,title:a.name})}return{isError:!1,isLoading:!1,output:r}}}),[a])})(_.file_id,d);j.isLoading||(j.isError?N="too_many_contents"===j.error[".tag"]:(V=j.output,N=!1));const H=a.useShowCopyLinkMiniModalCallback(),U=we.default.useMemo((()=>"centered"===y?{initialDisplayMode:"centered_v1"}:{initialDisplayMode:"anchored_v1",displayModeRef:E,displayModePositioning:h}),[y,E,h]),W=we.default.useCallback((()=>{var t,r;const{actionSurface:i,actionElement:n,fileOrFolder:o,user:s,...c}=e.$props.get();"anchored"===c.displayType&&(null===(t=c.onHoverLocked)||void 0===t||t.call(c,{isOpen:!0}));let l=()=>{};const _=new Promise((e=>{l=e}));if("undefined"!=typeof ClipboardItem&&navigator.clipboard.write){const e=new ClipboardItem({"text/plain":_});navigator.clipboard.write([e])}else _.then((e=>navigator.clipboard.writeText(e)));const d={write:e=>l(e)},u="undefined"!=typeof window&&window.innerWidth<=800?"bottom":h;M(s);const p="anchored"===c.displayType?{isCenteredDisplayed:!1,anchorRef:c.anchorRef,placement:u,yOffsetDistance:5,onHoverLocked:c.onHoverLocked}:{isCenteredDisplayed:!0};H.fn({user:s,filePath:o.file_id,setIsCreatingSharedLink:()=>{},browseFile:o,zIndexOverride:500,actionSurface:i,actionElement:n,origin:a.getOrigin(i,n),isFromShareMe24Modal:!0,clipboardWriter:d,withLockedStateModal:!1,userActionSource:null===(r=c.shareModalExtras)||void 0===r?void 0:r.userActionSource,...p})}),[e.$props,h,H,M]),B=we.default.useCallback((()=>{const{user:t,fileOrFolder:a,actionSurface:r,actionElement:n}=e.$props.get(),o=`sm24_${r}_${n}`,s=[a];i.asyncShowBrowseEntryPointOnboardingModal({primaryActionOnClick:()=>i.redirectToCreateTransferWithFiles(s,o),userId:t.id})}),[e]),Q=(e=>we.default.useCallback((t=>{const r=e.$props.get(),i=r.user,n=r.fileOrFolder,o={...r.shareModalExtras,initialScreen:a.SETTINGS_SCREEN,openSettingsFromShareMe24:!0,openLinkSettings:t.shouldOpenLinkSettings,initialTab:t.initialTab};a.asyncShowShareModal(i,n,o)}),[e]))(e),G=(e=>we.default.useCallback((()=>{const t=e.$props.get(),r=t.user,i=t.fileOrFolder,n={...t.shareModalExtras,initialScreen:a.MANAGE_SCREEN,openSettingsFromShareMe24:!0,openLinkSettings:!1};a.asyncShowShareModal(r,i,n)}),[e]))(e),z=we.default.useCallback((async()=>{if(!V)return;const e={name:a.getFilename(_)},t=V.map((e=>({file_gid:e.fileId,title:e.title})));await c.createStackAndAddFiles(r.intl,a.redirect,t,e)}),[V,_]);return we.default.createElement("div",null,we.default.createElement(Te,{sessionId:f,onRequestClose:b},we.default.createElement(s.MetadataProvider,{sharingObjectIdentifier:x,shareModalSessionId:f},we.default.createElement(a.ContextProvider,{context:s.Context$1,value:f},we.default.createElement(a.ContextProvider,{context:s.Context$2,value:O},we.default.createElement(a.ContextProvider,{context:s.Context$3,value:k},we.default.createElement(m.Provider,{objectIdentifier:x,sessionId:f,objMetadataNewApiVariant:"OFF"},we.default.createElement(Fe,{sessionId:f,actionElement:u,actionSurface:p,isDir:d},we.default.createElement(ke,{onFallback:$,onRequestClose:b},we.default.createElement(m.Main,{...U,isOpen:g,onRequestClose:b,inbandSharingMode:"controlled_v1",copyLinkMode:"controlled_v1",copyLinkHandler:W,transferMode:"controlled_v1",transferHandler:B,settingsMode:"controlled_v1",settingsHandler:Q,manageAccessHandler:G,objectIdentifier:x,progressiveInbandVariant:A,canUserUseTransfer:D,canContentUseTransfer:F,canUserEnableTransfer:P,isTransferEligibilityLoading:R,referrerLoggingMetadata:O,objectLoggingMetadata:k,onActionClicked:w,onInbandShareCompleted:C,fileOrFolder:_,canUserCreateStack:q,isFolderFileCountOverLimit:N,contents:V,createStackHandler:z}))))))))))};De.displayName="ShareMe24BrowseInternals";const Fe=({children:e,sessionId:r,actionElement:i,actionSurface:n,isDir:o})=>{const s=m.useData(),c=we.default.useRef(!1);return t.useEffect((()=>{if(!c.current)return"error"===s.status?(c.current=!0,void a.defaultEmitter$1.select(a.ON_LOADING_WRAPPER_DETECT_FAILURE).emit({sessionId:r,actionElement:i,actionSurface:n,isDir:o})):"loaded"===s.status?(c.current=!0,void a.defaultEmitter$1.select(a.ON_LOADING_WRAPPER_DETECT_SUCCESS).emit({sessionId:r,actionElement:i,actionSurface:n,isDir:o,isSharingBanned:s.accountMetadata.is_sharing_banned})):void 0}),[s.status,r,i,n,o]),t.useEffect((()=>()=>{c.current||(c.current=!0,a.defaultEmitter$1.select(a.ON_LOADING_WRAPPER_DETECT_CANCEL).emit({sessionId:r,actionElement:i,actionSurface:n,isDir:o}))}),[]),we.default.createElement(we.default.Fragment,null,e)};Fe.displayName="DataLoadingLogger",e.ShareMe24Browse=Le}));
//# sourceMappingURL=c_shareme24_browse_integration_index.after-display.js-vflkaFH20.map

//# debugId=bd298cdd-4a66-3be6-b216-4157356d1b25