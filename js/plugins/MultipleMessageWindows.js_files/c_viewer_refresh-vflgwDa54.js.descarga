!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="2a70aadd-f0b9-3342-823f-d060f604d965")}catch(e){}}();
define(["require","exports","./e_file_viewer_static_scl_page_file","react","./c_memoize-one","./c_init_data_debug_panel","./e_core_exception"],(function(e,t,a,n,r,c,o){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}var i=s(n);let p,u=!1;const l=()=>r.isSeleniumTest()||"undefined"!=typeof jest;function d(){return new Promise((async(t,n)=>{var s;window.recaptchaOnloadCallback=function(){t(window.grecaptcha)};if("ON"===(null===(s=(await a.fetchExperiment("ps_infra_load_funcaptcha")).experiment)||void 0===s?void 0:s.variant)&&u&&new Promise((function(t,a){e(["./c_abuse_funcaptcha_modal"],t,a)})).then((async({loadFuncaptchaModal:e,recordFunCaptchaLoadingStats:t})=>{const a=performance.now();let n,r=null,c=!1;try{await e(),c=!0}catch(e){r=e}finally{n=performance.now()}t("funcaptcha_modal_loading",n-a,c,r)})),l())t(v);else{const e=function(){const e={onload:"recaptchaOnloadCallback",render:"explicit",hl:r.getPageLocale().replace("_","-")};return new c.URI({scheme:"https",authority:"www.google.com",path:"/recaptcha/api.js",query:e}).toString()}(),t=window.CSP_SCRIPT_NONCE;if(!t)return o.reportException({err:new Error("CSP nonce not set"),severity:o.SEVERITY.CRITICAL,tags:["product-safety-infra","recaptcha"]}),void n();!function(e,t){const a=document.createElement("script");a.setAttribute("src",e),a.setAttribute("nonce",t),document.body.appendChild(a)}(e,t)}}))}const h={},_={};let f=0;const m=e=>{e.setAttribute("class","g-recaptcha-response"),e.setAttribute("name","g-recaptcha-response"),e.value=""},v={reset(e){const t=_[e].querySelector(".g-recaptcha-response");return m(t),!0},render(e,t,a){const n=f;f+=1,c.assert(null==e.querySelector(".g-recaptcha-response"),"can't render multiple recaptcha elements in same div");const r=document.createElement("textarea");return r.id=`g-recaptcha-response-${n}`,m(r),e.appendChild(r),_[n]=e,h[n]=()=>{const e="DUMMY-RESPONSE";return r.value=e,t.callback&&t.callback(e),e},n},execute:e=>Promise.resolve(h[e]())};class w extends i.default.Component{constructor(e){super(e)}handle_captcha_errors(t,n){return t&&t.funcaptcha_verification_error&&a.notifyCaptchaConnectionError(),!(!t||!t.funcaptcha_response)&&(new Promise((function(t,a){e(["./c_abuse_funcaptcha_modal"],t,a)})).then((({openFuncaptchaModal:e})=>{e(this.props.email||"",n||this.props.source,(e=>{this.funcaptcha_response=e,this.props.onSubmit()}),this.props.onReady)})),!0)}clear_captcha_response(){this.funcaptcha_response=void 0}componentDidMount(){var e,t;e=void 0,void 0!==(t=!0)&&(u=t),p||(p=e?new Promise(((e,t)=>{a.waitForTTI().then(e),setTimeout(e,2500)})).then(d):d())}render(){return i.default.createElement("div",{ref:"container_div",className:a.cx({"recaptcha-v2-challenge-container":!0,"recaptcha-v2-challenge-container--invisible":!0})},i.default.createElement("div",{ref:"captcha_div",className:"recaptcha_v2_challenge"}))}submit(){this.clear_captcha_response(),this.props.onSubmit()}}w.displayName="CaptchaComponent";const g=a.requireCssWithComponent(w,["/static/metaserver/static/css/recaptcha-vflIN6j39.css"]);function C(e){var t,n,r;const c=null!==(t=null==e?void 0:e.path)&&void 0!==t?t:"/get_viewer",o=null!==(n=null==e?void 0:e.routeParams)&&void 0!==n?n:{},s=null!==(r=null==e?void 0:e.base)&&void 0!==r?r:window.location.origin;return new a.AjaxURL(a.replacePattern(c,o),s)}t.Captcha=g,t.clear_captcha_response=function(e){return e.getWrappedComponent().clear_captcha_response()},t.dangerousDoNotUseDeprecatedRefreshViewerAfterLogin=async(e=!1)=>{if(!e){const e=await a.fetchViewer();c.assert(!e.is_signed_in,"Attempted to use dangerousDoNotUseDeprecatedRefreshViewerAfterLogin but already logged in")}const t=await new Promise(((e,t)=>a.WebRequest({url:C(),success:a=>{try{e(JSON.parse(a))}catch(e){t({error:e})}},error:(e,a,n)=>{t({error:n})}}))),n=(t._user_data||[]).find((({id:e})=>e===t.active_user_id));!function(e){const t=r.getInitData();e={...t.authRequestInfo||{},...e},r.init({...t,authRequestInfo:new r.AuthRequestInfo(e)})}({activeUser:new r.User({id:r.protoInt64.parse(t.active_user_id||"0"),rootNsId:r.protoInt64.parse((null==n?void 0:n.root_ns_id)||"0")}),activeTeam:new r.Team({id:r.protoInt64.parse(t.team_id||"0")}),authRole:Number(t.auth_role||"0"),authActionType:Number(t.auth_action_type||"0")}),await a.invalidateViewer()},t.get_captcha_responses=function(e){const t=e.getWrappedComponent();return{"g-recaptcha-response":t.recaptcha_response,"funcaptcha-response":t.funcaptcha_response}},t.handle_captcha_errors=function(e,t,a){return e.getWrappedComponent().handle_captcha_errors(t,a)}}));
//# sourceMappingURL=c_viewer_refresh.js-vflxKVN79.map

//# debugId=2a70aadd-f0b9-3342-823f-d060f604d965